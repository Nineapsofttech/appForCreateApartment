"use strict";angular.module("manage.controllers",["ngCookies","ngTouch","ngAnimate","ngSanitize"]).controller("ManageCtrl",["$scope","$rootScope","$routeParams",function(e,o){angular.element(document).ready(function(){o.checkpermission()})}]).controller("editBuildingCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$location","Building","Adsservice",function(e,o,t,r,i,n,a){angular.element(document).ready(function(){o.checkpermission()}),e.building={},a.get({building_id:r.building_id},function(o){e.building=o}),e.editbuilding=function(){e.building.user_ref?a.post({building:e.building},function(e){t.warn(e),a.query({user_ref:i.UID},function(e){o.building_list=e,o.initwaiting=1,n.path("manage_building"),n.replace()})}):alert("กรุณา login หรือ หรือเปิดใช้งาน Cookies หากขัดข้องกรุณาติดต่อเจ้าหน้าที่")}}]).controller("editRoomCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$location","Building","Room",function(e,o,t,r,i,n,a,s){angular.element(document).ready(function(){o.checkpermission()}),e.room={},e.room.images=[],e.services=[],s.get({_id:r.room_id},function(o){e.room=o,e.room.images||(e.room.images=[]),e.services=e.room.service}),e.imagesupload=function(o){var t=new FormData;if(o.type.match("image.*"));else{t.append("image",o.files[0]);var r=new XMLHttpRequest;r.upload.onprogress=function(e){e.loaded/e.total*100},r.onload=function(){200==r.status?(e.room.images.push(r.responseText),e.$apply()):alert("Error! Upload failed")},r.onerror=function(){alert("Error! Upload failed. Can not connect to server.")},r.open("POST","/resizeimage"),r.send(t)}},e.editroom=function(){i.UID?(t.warn(e.services),t.log(e.room),e.room.room_rate_daily=parseInt(e.room.room_rate_daily),e.room.service=e.services,s.post({room:e.room},function(e){t.warn(e),n.path("/manage_room").search("building_id="+e.building_ref),n.replace()})):alert("กรุณา login หรือ หรือเปิดใช้งาน Cookies หากขัดข้องกรุณาติดต่อเจ้าหน้าที่")}}]).controller("EditPropertyCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$location","Building","Adsservice","PropertyApi",function(e,o,t,r,i,n,a,s,c){e.bank_details=[],angular.element(document).ready(function(){o.checkpermission()}),c.get({_id:r.property_id},function(o){e.post=o,e.post.bank_detail?e.bank_details=e.post.bank_detail:e.post.bank_detail=[]}),e.isDuplicate=function(){Duplicate.query({namespace:e.post.namespace},function(o){if(o.status)e.duplicatestatus=!1;else try{o.data&&o.data._id!==e.up._id.toString()?(e.register.namespace.$error.pattern=!0,e.duplicatestatus=!0):e.duplicatestatus=!1}catch(t){e.duplicatestatus=!0}})},e.logoupload=function(o){var t=new FormData;if(o.type.match("image.*"));else{t.append("image",o.files[0]);var r=new XMLHttpRequest;r.upload.onprogress=function(e){e.loaded/e.total*100},r.onload=function(){200==r.status?(e.post.logo=r.responseText,e.$apply()):alert("Error! Upload failed")},r.onerror=function(){alert("Error! Upload failed. Can not connect to server.")},r.open("POST","/resizeimage"),r.send(t)}},e.imageheaderupload=function(o){var t=new FormData;if(o.type.match("image.*"));else{t.append("image",o.files[0]);var r=new XMLHttpRequest;r.upload.onprogress=function(e){e.loaded/e.total*100},r.onload=function(){200==r.status?(e.post.image_header=r.responseText,e.$apply()):alert("Error! Upload failed")},r.onerror=function(){alert("Error! Upload failed. Can not connect to server.")},r.open("POST","/resizeimage"),r.send(t)}},e.imagesupload=function(o){var t=new FormData;if(o.type.match("image.*"));else{t.append("image",o.files[0]);var r=new XMLHttpRequest;r.upload.onprogress=function(e){e.loaded/e.total*100},r.onload=function(){200==r.status?(e.post.images.push(r.responseText),e.$apply()):alert("Error! Upload failed")},r.onerror=function(){alert("Error! Upload failed. Can not connect to server.")},r.open("POST","/resizeimage"),r.send(t)}},e.editproperty=function(){e.post.bank_detail=e.bank_details,c.post(e.post,function(e){t.warn(e),n.path("manage_property"),n.replace()})}}]).controller("ConfirmRentCtrl",["$window","$filter","$scope","$rootScope","$log","$routeParams","$cookies","$location","Building","Room","PropertyApi","CustomerApi","TransactionApi",function(e,o,t,r,i,n,a,s,c,l,u,p,d){if(angular.element(document).ready(function(){r.checkpermission();var e="example1234";e=e.toUpperCase(),t.codetoupper=e,$("#bar_key").barcode(t.codetoupper,"code39")}),t.roomid=n.room_id,t.select={person:{}},t.pricetostring=o("thbToString")(r.transaction.reserve_price),t.confirmwaiting=0,t.confirm_submit=function(){t.confirmwaiting=1,delete r.transaction._id,d.post(r.transaction,function(e){console.log(e),e&&e._id?(t.confirmwaiting=0,s.path("print_report_booking").search("transaction_id="+e._id),s.replace()):alert("error")})},l.query({building_ref:n.building_id},function(e){t.room_list=e,t.waiting=1}),t.customerquerylist=[],r.select)if(r.select.person){for(var m in r.select.person)r.select.person[m]&&t.customerquerylist.push(m);0===t.customerquerylist.length?(s.path("select_customer"),s.replace()):1===t.customerquerylist.length?p.get({_id:t.customerquerylist[0]},function(e){t.customer_list=[],t.customer_list.push(e),i.warn(t.customer_list)}):p.query({person_list:t.customerquerylist},function(e){t.customer_list=e,i.warn(t.customer_list)})}else s.path("select_customer"),s.replace();else s.path("select_customer"),s.replace()}]).controller("ManageBillingCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$location","Building","Room","CustomerApi",function(e,o,t,r,i,n,a,s,c){o.checkpermission(),e.select={person:{}},s.query({building_ref:r.building_id},function(o){e.room_list=o,e.waiting=1}),c.query({parrent:i.UID},function(o){e.customer_list=o,t.warn(e.customer_list)})}]).controller("RoomDetailCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$location","Building","Room","CustomerApi",function(e,o,t,r,i,n,a,s,c){o.checkpermission(),e.select={person:{}},s.query({building_ref:r.building_id},function(o){e.room_list=o,e.waiting=1}),c.query({parrent:i.UID},function(o){e.customer_list=o,t.warn(e.customer_list)})}]).controller("UpdatePaymentCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$location","Building","Room","CustomerApi",function(e,o,t,r,i,n,a,s,c){o.checkpermission(),e.select={person:{}},s.query({building_ref:r.building_id},function(o){e.room_list=o,e.waiting=1}),c.query({parrent:i.UID},function(o){e.customer_list=o,t.warn(e.customer_list)})}]).controller("ManageWaterCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$location","Building","Room","CustomerApi","WaterApi",function(e,o,t,r,i,n,a,s,c,l){o.checkpermission(),e.post={},e.select={person:{}},s.query({building_ref:r.building_id},function(o){e.room_list=o,e.waiting=1}),e.insert=function(o){e.post.room_ref=o,l.post(e.post,function(){})},c.query({parrent:i.UID},function(o){e.customer_list=o,t.warn(e.customer_list)}),e.select_building=function(e){n.path("manage_water").search("building_id="+e),n.replace()}}]).controller("ManageElecCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$location","Building","Room","CustomerApi","ElectApi",function(e,o,t,r,i,n,a,s,c,l){e.post={},o.checkpermission(),e.select={person:{}},s.query({building_ref:r.building_id},function(o){e.room_list=o,e.waiting=1}),e.insert=function(o){e.post.room_ref=o,l.post(e.post,function(){})},c.query({parrent:i.UID},function(o){e.customer_list=o,t.warn(e.customer_list)}),e.select_building=function(e){n.path("manage_elec").search("building_id="+e),n.replace()}}]).controller("CustomerBillingCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$location","Building","Room","TransactionApi",function(e,o,t,r,i,n,a,s,c){o.checkpermission(),e.select={person:{}},c.query({customer_id:r.customer_id},function(o){e.transaction_list=o}),s.query({building_ref:r.building_id},function(o){e.room_list=o,e.waiting=1})}]).controller("AddPropertyCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$location","Building","Adsservice","PropertyApi","Duplicate",function(e,o,t,r,i,n,a,s,c,l){angular.element(document).ready(function(){o.checkpermission()}),e.post={},e.post.images=[],e.post.location=[],e.isDuplicate=function(){l.query({namespace:e.post.namespace},function(o){if(o.status)e.duplicatestatus=!1;else try{o.data&&o.data._id!==e.up._id.toString()?(e.register.namespace.$error.pattern=!0,e.duplicatestatus=!0):e.duplicatestatus=!1}catch(r){e.duplicatestatus=!0,t.log(e.duplicatestatus),t.log(r)}})},e.logoupload=function(o){var t=new FormData;if(o.type.match("image.*"));else{t.append("image",o.files[0]);var r=new XMLHttpRequest;r.upload.onprogress=function(e){e.loaded/e.total*100},r.onload=function(){200==r.status?(e.post.logo=r.responseText,e.$apply()):alert("Error! Upload failed")},r.onerror=function(){alert("Error! Upload failed. Can not connect to server.")},r.open("POST","/resizeimage"),r.send(t)}},e.imageheaderupload=function(o){var t=new FormData;if(o.type.match("image.*"));else{t.append("image",o.files[0]);var r=new XMLHttpRequest;r.upload.onprogress=function(e){e.loaded/e.total*100},r.onload=function(){200==r.status?(e.post.image_header=r.responseText,e.$apply()):alert("Error! Upload failed")},r.onerror=function(){alert("Error! Upload failed. Can not connect to server.")},r.open("POST","/resizeimage"),r.send(t)}},e.imagesupload=function(o){var t=new FormData;if(o.type.match("image.*"));else{t.append("image",o.files[0]);var r=new XMLHttpRequest;r.upload.onprogress=function(e){e.loaded/e.total*100},r.onload=function(){200==r.status?(e.post.images.push(r.responseText),e.$apply()):alert("Error! Upload failed")},r.onerror=function(){alert("Error! Upload failed. Can not connect to server.")},r.open("POST","/resizeimage"),r.send(t)}},e.insert=function(){c.post(e.post,function(e){t.warn(e),n.path("manage_property"),n.replace()})}}]).controller("ReportCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$location","Building","Room","TransactionApi",function(e,o,t,r,i,n,a,s,c){angular.element(document).ready(function(){o.checkpermission(),c.query({transaction_id:r.transaction_id},function(o){t.log(o),e.room_list=o})})}]).controller("SelectCustomerCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$location","Building","Room","CustomerApi",function(e,o,t,r,i,n,a,s,c){angular.element(document).ready(function(){o.checkpermission()}),e.roomid=r.room_id,o.select={person:{}},s.query({building_ref:r.building_id},function(o){e.room_list=o,e.waiting=1}),c.query({parrent:i.UID},function(o){e.customer_list=o,t.warn(e.customer_list)})}]).controller("SelectRentTypeCtrl",["$scope","$filter","$rootScope","$log","$routeParams","$cookies","$location","Building","Room","CustomerApi","ElectApi","WaterApi",function(e,o,t,r,i,n,a,s,c,l,u,p){angular.element(document).ready(function(){e.customerquerylist=[],t.checkpermission(),e.roomid=i.room_id,e.post={},e.post.date=new Date,e.post.move_in_date=new Date;var s="example1234";if(s=s.toUpperCase(),e.codetoupper=s,$("#bar_key").barcode(e.codetoupper,"code39"),e.$watch("post.customer_ref",function(){try{for(var o=e.customer_list.length-1;o>=0;o--)if(e.customer_list[o]._id.toString()===e.post.customer_ref.toString())for(var t in e.customer_list[o])"address"===t?e.post.customer_address=e.customer_list[o].address:"birth_date"===t?e.post[t]=new Date(e.customer_list[o][t]):"date"===t||(e.post[t]=e.customer_list[o][t])}catch(r){}}),e.post.reserve_price="",e.$watch("post.reserve_price",function(){try{e.pricetostring=o("thbToString")(e.post.reserve_price)}catch(t){}}),c.get({get_property:e.roomid},function(o){o&&(e.post.coverage=isNaN(o.deposite)?0:parseInt(o.deposite),e.post.common_fee_charge=isNaN(o.utility)?0:parseInt(o.utility),e.post.furniture=isNaN(o.room_furniture)?0:parseInt(o.room_furniture),e.post.car_park_fee=isNaN(o.parking)?0:parseInt(o.parking),e.post.internet_fee=isNaN(o.net_bill)?0:parseInt(o.net_bill),e.post.title=o.title,e.post.contact_mobile=o.contact_mobile,e.post.contact_tel=o.contact_tel,e.post.contact_email=o.contact_email,e.post.contact_fax=o.contact_fax,e.post.address=o.address,e.post.property_ref=o._id,u.get({room_ref:e.roomid},function(o){e.post.elect_meter=o._id?o.elect_meter:0}),p.get({room_ref:e.roomid},function(o){e.post.water_meter=o._id?o.water_meter:0}))}),c.get({_id:i.room_id},function(o){e.post.room_no=o.room_no;for(var r=t.building_list.length-1;r>=0;r--)t.building_list[r]._id===o.building_ref._id&&(e.post.building=t.building_list[r].building,e.post.building_no=t.building_list[r].building_no,e.post.building_ref=t.building_list[r]._id,e.post.property_ref=t.building_list[r].property_ref._id)}),e.setpost=function(){e.post.ac=[];for(var o=e.customer_list.length-1;o>=0;o--)e.post.ac.push(e.customer_list[o]._id);e.post.room_ref=e.roomid,e.post.user_ref=n.UID,t.transaction=e.post,r.log(t.transaction)},t.select)if(t.select.person){for(var d in t.select.person)t.select.person[d]&&e.customerquerylist.push(d);0===e.customerquerylist.length?(a.path("select_customer"),a.replace()):1===e.customerquerylist.length?l.get({_id:e.customerquerylist[0]},function(o){e.customer_list=[],e.customer_list.push(o),r.warn(e.customer_list)}):l.query({person_list:e.customerquerylist},function(o){e.customer_list=o,r.warn(e.customer_list)})}else a.path("select_customer"),a.replace();else a.path("select_customer"),a.replace()})}]).controller("FormPersonCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$http","$location","CustomerApi","Room",function(e,o,t,r,i,n,a,s){angular.element(document).ready(function(){o.checkpermission()}),e.post={},e.insert=function(){e.post.parrent=i.UID,s.post(e.post,function(e){t.warn(e),a.path("select_customer").search("room_id="+r.room_id),a.replace()})};var c=new FormData;e.idcarduploadfront=function(o){if(c=new FormData,o.type.match("image.*"));else{c.append("image",o.files[0]);var t=new XMLHttpRequest;t.upload.onprogress=function(e){e.loaded/e.total*100},t.onload=function(){200==t.status?e.post.id_card_pic_front=t.responseText:alert("Error! Upload failed")},t.onerror=function(){alert("Error! Upload failed. Can not connect to server.")},t.open("POST","/idcard"),t.send(c)}},e.idcarduploadback=function(o){if(c=new FormData,o.type.match("image.*"));else{c.append("image",o.files[0]);var t=new XMLHttpRequest;t.upload.onprogress=function(e){e.loaded/e.total*100},t.onload=function(){200==t.status?e.post.id_card_pic_back=t.responseText:alert("Error! Upload failed")},t.onerror=function(){alert("Error! Upload failed. Can not connect to server.")},t.open("POST","/idcard"),t.send(c)}}}]).controller("PersonCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$http","$location","CustomerApi","Room",function(e,o,t,r,i,n,a,s){function c(e){var o;o=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);for(var t=e.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(o.length),i=0;i<o.length;i++)r[i]=o.charCodeAt(i);return new Blob([r],{type:t})}if(angular.element(document).ready(function(){o.checkpermission()}),e.post={},!o.isMobile){var l=document.getElementById("canvas"),u=l.getContext("2d"),p=document.getElementById("video"),d={video:!0},m=function(){};navigator.getUserMedia?navigator.getUserMedia(d,function(e){p.src=e,p.play()},m):navigator.webkitGetUserMedia?navigator.webkitGetUserMedia(d,function(e){p.src=window.webkitURL.createObjectURL(e),p.play()},m):navigator.mozGetUserMedia&&navigator.mozGetUserMedia(d,function(e){p.src=window.URL.createObjectURL(e),p.play()},m),document.getElementById("snap").addEventListener("click",function(){u.drawImage(p,0,0,640,480);var o=l.toDataURL("image/png"),t=c(o),r=new FormData;r.append("image",t);var i=new XMLHttpRequest;i.upload.onprogress=function(e){e.loaded/e.total*100},i.onload=function(){200==i.status?e.post.id_card_pic_front=i.responseText:alert("Error! Upload failed")},i.onerror=function(){alert("Error! Upload failed. Can not connect to server.")},i.open("POST","/idcard"),i.send(r)})}e.insert=function(){e.post.parrent=i.UID,s.post(e.post,function(e){t.warn(e),a.path("manage_customer"),a.replace()})};var g=new FormData;e.idcarduploadfront=function(o){if(g=new FormData,o.type.match("image.*"));else{g.append("image",o.files[0]);var t=new XMLHttpRequest;t.upload.onprogress=function(e){e.loaded/e.total*100},t.onload=function(){200==t.status?e.post.id_card_pic_front=t.responseText:alert("Error! Upload failed")},t.onerror=function(){alert("Error! Upload failed. Can not connect to server.")},t.open("POST","/idcard"),t.send(g)}},e.idcarduploadback=function(o){if(g=new FormData,o.type.match("image.*"));else{g.append("image",o.files[0]);var t=new XMLHttpRequest;t.upload.onprogress=function(e){e.loaded/e.total*100},t.onload=function(){200==t.status?e.post.id_card_pic_back=t.responseText:alert("Error! Upload failed")},t.onerror=function(){alert("Error! Upload failed. Can not connect to server.")},t.open("POST","/idcard"),t.send(g)}}}]).controller("EditPersonCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$location","CustomerApi","Room",function(e,o,t,r,i,n,a){angular.element(document).ready(function(){o.checkpermission()}),a.get({_id:r.person_id},function(o){e.post=o,e.post.birth_date=new Date(o.birth_date)}),e.update=function(){a.post(e.post,function(e){t.warn(e),n.path("manage_customer"),n.replace()})}}]).controller("PrintReportCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$location","Building","Room","TransactionApi",function(e,o,t,r,i,n,a,s,c){angular.element(document).ready(function(){o.checkpermission()}),c.get({transaction_id:r.transaction_id},function(o){e.buildingid=o.building_ref._id,t.log(o)})}]).controller("PrintReportBookingCtrl",["$scope","$filter","$rootScope","$log","$routeParams","$cookies","$location","Building","Room","TransactionApi",function(e,o,t,r,i,n,a,s,c,l){angular.element(document).ready(function(){t.checkpermission()}),l.get({transaction_id:i.transaction_id},function(t){e.buildingid=t.building_ref._id,e.post=t,e.pricetostring=o("thbToString")(e.post.reserve_price.toString());var i=t._id;i=i.toUpperCase(),e.codetoupper=i,$("#bar_key").barcode(e.codetoupper,"code39"),r.log(t)})}]).controller("PrintReceiptBookingCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$location","Building","Room","TransactionApi",function(e,o,t,r,i,n,a,s,c){angular.element(document).ready(function(){o.checkpermission()}),c.get({transaction_id:r.transaction_id},function(o){e.transaction=o,e.buildingid=o.building_ref._id,t.log(o)})}]).controller("PropertyCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$location","Building","Adsservice","PropertyApi",function(e,o,t,r,i,n,a,s,c){angular.element(document).ready(function(){o.checkpermission()}),s.query({user_id:i.UID},function(o){e.property_list=o}),e.remove_building=function(o){var r=confirm("คุณต้องการลบ "+name+" ออกจากระบบ");1==r&&c.remove({_id:o},function(o){t.warn(o),s.query({user_id:i.UID},function(o){e.property_list=o})})}}]).controller("BuildingCtrl",["$scope","$rootScope","$log","$routeParams","$cookies","$location","Building","Adsservice",function(e,o,t,r,i,n,a,s){angular.element(document).ready(function(){o.checkpermission()}),e.building={},s.query({user_id:i.UID},function(o){e.property_list=o}),e.addbuilding=function(){e.building.property_ref=e.property._id,e.building.user_ref=i.UID,e.building.user_ref?a.post({building:e.building},function(e){t.warn(e),a.query({user_ref:i.UID},function(e){o.building_list=e,o.initwaiting=1,n.path("manage_building"),n.replace()})}):alert("กรุณา login หรือ หรือเปิดใช้งาน Cookies หากขัดข้องกรุณาติดต่อเจ้าหน้าที่")}}]).controller("ManageCustomerCtrl",["$scope","$rootScope","$cookies","$routeParams","$log","CustomerApi",function(e,o,t,r,i,n){angular.element(document).ready(function(){o.checkpermission()}),n.query({parrent:t.UID},function(o){e.customerlist=o,i.warn(e.customer_list)}),e.del=function(o,r){var a=confirm("คุณต้องการลบ "+r+" ออกจากระบบ");1==a&&n.remove({_id:o},function(o){i.warn(o),n.query({parrent:t.UID},function(o){e.customerlist=o,i.warn(e.customer_list)})})}}]).controller("RoomCtrl",["$scope","$rootScope","$routeParams","$log","$location","Room","PropertyApi",function(e,o,t,r,i,n,a){angular.element(document).ready(function(){o.checkpermission()}),e.room={},e._id=t.building_id;for(var s=o.building_list.length-1;s>=0;s--)o.building_list[s]._id===e._id&&a.get({_id:o.building_list[s].property_ref},function(o){e.room.room_rate_daily=o.dailyprice,e.room.room_rate=o.price_min,r.log(o)});r.log(o.building_list),e.addroom=function(){e.room.building_ref=t.building_id,r.log(e.room),n.post({room:e.room},function(e){r.warn(e),i.path("/manage_room").search("building_id="+t.building_id),i.replace()})}}]).controller("ManagebuildingCtrl",["$scope","$routeParams","$rootScope","$log","$cookies","Building",function(e,o,t,r,i,n){angular.element(document).ready(function(){t.checkpermission()}),e.room={},e.remove_building=function(e,o){var a=confirm("คุณต้องการลบตึก "+o);1==a&&n.remove({building_id:e},function(e){r.warn(e),alert("ตึก "+e.building+" ถูกลบเรียบร้อยแล้ว"),n.query({user_ref:i.UID},function(e){t.building_list=e,t.initwaiting=1})})}}]).controller("ManageRoomCtrl",["$scope","$routeParams","$rootScope","$log","$location","Room","Building",function(e,o,t,r,i,n,a){angular.element(document).ready(function(){t.checkpermission()}),a.get({building_id:o.building_id},function(o){e.building_detail=o}),o.building_id&&(e.waiting=0,n.query({building_ref:o.building_id},function(o){e.room_list=o,e.waiting=1})),e.select_building=function(e){i.path("manage_room").search("building_id="+e),i.replace()},e.remove_room=function(t,r){var i=confirm("คุณต้องการลบห้อง "+r);1==i&&n.remove({room_id:t},function(){n.query({building_ref:o.building_id},function(o){e.room_list=o,e.waiting=1})})}}]).controller("loginCtrl",["$scope","$rootScope","$routeParams","$location","$log","$cookies","Check","Building",function(e,o,t,r,i,n,a,s){angular.element(document).ready(function(){o.checkpermission()}),n.UID&&(r.path("/index"),r.replace()),e.login=function(){a.query({username:e.login.username,password:e.login.pass},function(t){i.warn(t),void 0!==t.permission?(n.Tel=t.tel,n.Name=t.name,n.UID=t._id,n.Hash=t.password,n.Permission=t.permission,n.Email=t.email,n.Favoriteap=t.favoriteap,o.permissionGlobal=n.Permission,o.username=n.Name,o.idme=n.UID,e.displayCheckBox=!1,s.query({user_ref:n.UID},function(e){o.building_list=e,o.initwaiting=1,i.log(o.building_list)}),r.path("/index"),r.replace()):alert("Please Check your username and password")})}}]);
