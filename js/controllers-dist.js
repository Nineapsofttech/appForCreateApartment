"use strict";function rand(){for(var e=[];e.length<5;){var o=Math.floor(5*Math.random()+1);contains(e,o)||e.push(o)}return e}function contains(e,o){for(var t=0;t<e.length;t++)if(e[t]===o)return!0;return!1}angular.module("world.controllers",["ngCookies","angular-carousel","ngTouch","xeditable","textAngular","pickadate","ngAnimate","ngSanitize","mgcrea.ngStrap","checklist-model"]).controller("MainController",["$scope","$rootScope",function(){}]).controller("paypalSuccess",["$scope","socket","$filter","$routeParams",function(e,o,t,n){e.payer=n.payer,e.packages=n.transactions,e.amount=n.amount,e.state=n.status}]).controller("reporttrackerCtrl",["$scope","socket","$filter","$routeParams","salelist",function(e,o,t,n,a){e.search=function(){a.get({from:new Date(e.check1).getTime(),to:new Date(e.check2).getTime()},function(o){e.salelist=o,console.log(o)})}}]).controller("Adsmanage",["$scope","$rootScope","$window","$cookies","$route","$routeParams","$location","Adsservice","Adscreation","socket","Adsstatus",function(e,o,t,n,a,i,r,l,c,s,d){e.properties={},e.ads={},e.properties=l.query({user_id:n.UID}),o.$broadcast("adsmapReady",!0),e.ads.sale_id=n.UID,void 0!==i._id&&d.query({adsid:i._id},function(o){e.ads=o})}]).controller("Testunit",["$scope","socket","Permission","Userlist","$filter",function(e,o,t,n,a){e.perobj={},e.user={},e.newpermission={},t.query({permission:{}},function(o){o&&(e.perobj=o)}),n.query({},function(o){o&&(e.user=o)}),e.addPermission=function(){e.inserted={detail:""},e.perobj.push(e.inserted)},e.savePermission=function(e,o){e.detail=o,void 0===e.id?t.post({permis:e},function(){}):t.post({permis:e},function(){})},e.showStatus=function(o){var t=[];return o.permission&&(t=a("filter")(e.perobj,{permission:o.permission})),t.length?t[0].detail:"Standard User"},e.loadGroups=function(){return e.perobj.length?null:t.query({permission:{}},function(o){o&&(e.perobj=o)})},e.saveUser=function(e,o){e._id=o,t.post({permis:e},function(){})},e.removeUser=function(o){e.user.splice(o,1)}}]).controller("ChatController",["$scope","socket",function(e,o){o.emit("hello","hello world!")}]).controller("CreateBuildingCtrl",["$scope","$routeParams","Building",function(e,o,t){e.building={},e.lists=t.query(function(){}),e.create=function(){t.post({building:e.building},function(){})}}]).controller("templateCtrl",["$window","$rootScope",function(){}]).controller("commentCtrl",["$window","$rootScope","$scope","$location","$cookies","$routeParams","Board","socket",function(e,o,t,n,a,i,r,l){t.error_alert=function(e,t){o.closed=!1,document.getElementById("error_containner").className="modal__upload",document.getElementById("errtitle").innerHTML=e,document.getElementById("errmessage").innerHTML=t},t.firstime=-1,t.feedback={},t.comment={},t.detail_comment={};n.path();r.feed({board_id:i._id},function(o){t.detail_comment=o.comment,t.title=o.board[0].title,t.detail=o.board[0].detail,console.log(o),e.prerenderReady=!0}),t.current_comment=1,console.log(i),t._id=i._id,t.reloadpage=function(){e.location.reload()},t.post_feedback_send=function(){console.log(t.feedback),t.feedback.user_id=$cookiesUID,t.feedback.category="feedback",void 0===t.feedback.user_id?alert("กรุณา Login ก่อนครับ"):r.create({feedback:t.feedback},function(e){alert(e.status),l.emit("Boardupdate",a.UID)})},t.feedclose=function(o){var n=document.getElementById("feedbackcommentbox"+o),a=n.offsetLeft-n.scrollLeft+n.clientLeft,i=n.offsetTop-n.scrollTop+n.clientTop;e.scrollTo(a,i-150),n.focus(),n.style.height="50px",t.current_comment=-1},t.post_comment_send=function(){console.log("post"),t.comment.board_id=t._id,t.comment.user_id=a.UID,t.comment.category="feedback",r.comment({comments:t.comment},function(){r.feed({board_id:i._id},function(e){t.detail_comment=e,console.log(e),document.getElementById("commentbox").value=""})})}}]).controller("feedbackCtrl",["$window","$rootScope","$scope","$location","$cookies","Board","socket",function(e,o,t,n,a,i,r){t.error_alert=function(e,t){o.closed=!1,document.getElementById("error_containner").className="modal__upload",document.getElementById("errtitle").innerHTML=e,document.getElementById("errmessage").innerHTML=t},t.firstime=-1,t.feedback={},t.comment={},t.detail_comment={};var l=n.path();i.feed({feedback_feed:"feedback"},function(e){t.feedbackfeed=e.data}),t.path=l,t.current_comment=1,t.reloadpage=function(){e.location.reload()},t.post_feedback_send=function(){console.log(t.feedback),t.feedback.user_id=a.UID,t.feedback.category="feedback",void 0===t.feedback.user_id?alert("กรุณา Login ก่อนครับ"):i.create({feedback:t.feedback},function(e){alert(e.status),r.emit("Boardupdate",a.UID)})},t.feedcomment=function(o,n){console.log("---------------------"),console.log(n),console.log(o),t.container=document.getElementsByClassName("feedback--comment--container"),t.detail_comment=i.feed({comment_feed:"1",board_id:o},function(){var o;if(void 0!==n?(t.current_comment=n,o=document.getElementById("feedbackcommentbox"+t.current_comment)):o=document.getElementById("feedbackcommentbox"+t.current_comment),console.log(o),void 0===a.UID)o.style.display="none",t.firstime&&(t.error_alert("เอ๊ะคันไม้คันมือแล้วสิ",'ถ้าหากอยาก Comment <a onclick=\'document.getElementById("close_modal").click();document.getElementById("login-form").className="modal__upload"\' >Login ก่อนนะ </a>ถ้ายังไม่มีสมาชิก  <a onclick=\'document.getElementById("close_modal").click();\' href=\'/#!/register\'>สมัครที่นี่เลย</a>'),t.firstime=0);else{o.style.display="";var i=o.offsetLeft-o.scrollLeft+o.clientLeft,r=o.offsetTop-o.scrollTop+o.clientTop;e.scrollTo(i,r-150),o.focus(),o.style.height="300px"}})},t.feedclose=function(o){var n=document.getElementById("feedbackcommentbox"+o),a=n.offsetLeft-n.scrollLeft+n.clientLeft,i=n.offsetTop-n.scrollTop+n.clientTop;e.scrollTo(a,i-150),n.focus(),n.style.height="50px",t.current_comment=-1},t.post_comment_send=function(e){t.comment.board_id=e,t.comment.user_id=a.UID,t.comment.category="feedback",i.comment({comments:t.comment},function(){t.feedcomment(t.comment.board_id)})}}]).controller("webboardCtrl",["$window","$rootScope","$scope","$location","$cookies","$route","Board",function(){}]).controller("boardCtrl",["$window","$rootScope","$scope","$location","$cookies","Board","socket",function(e,o,t,n,a,i,r){t.feedback={},t.comment={},t.detail_comment={},t.select_board="/webboard",i.feed({feedback_feed:"board"},function(e){t.boardfeed=e.data}),t.reloadpage=function(){e.location.reload()},t.post_feedback_send=function(){t.feedback.user_id=a.UID,t.feedback.category="board",void 0===t.feedback.user_id?alert("กรุณา Login ก่อนครับ"):i.create({feedback:t.feedback},function(e){alert(e.status),t.feedback="",r.emit("Boardupdate",a.UID)})},t.feedcomment=function(o,n){t.detail_comment=i.feed({comment_feed:1,board_id:o},function(){var o=document.getElementById("commentbox"+n),t=o.offsetLeft-o.scrollLeft+o.clientLeft,a=o.offsetTop-o.scrollTop+o.clientTop;e.scrollTo(t,a-150),o.focus(),o.style.height="300px"})},t.feedclose=function(o){var t=document.getElementById("commentbox"+o),n=t.offsetLeft-t.scrollLeft+t.clientLeft,a=t.offsetTop-t.scrollTop+t.clientTop;e.scrollTo(n,a-150),t.focus(),t.style.height="50px"},t.post_comment_send=function(e){void 0===a.UID?alert("กรุณา Login ก่อนครับ"):(t.comment.board_id=e,t.comment.user_id=a.UID,t.comment.category="feedback",i.comment({comments:t.comment},function(){t.feedcomment(t.comment.board_id)}))}}]).controller("boardadsCtrl",["$window","$rootScope","$scope","$location","$cookies","Board","socket",function(e,o,t,n,a,i,r){t.feedback={},t.comment={},t.detail_comment={};var l=n.path();t.adsfeed=i.feed({feedback_feed:"ads"}),t.path=l,r.on("BoardUpdated",function(o){console.log(o),o===a.UID&&e.location.reload()}),t.reloadpage=function(){e.location.reload()},t.post_feedback_send=function(){t.feedback.user_id=a.UID,t.feedback.category="ads",void 0===t.feedback.user_id?alert("กรุณา Login ก่อนครับ"):i.create({feedback:t.feedback},function(e){alert(e.status),r.emit("Boardupdate",a.UID)})},t.feedcomment=function(o,n){t.detail_comment=i.feed({comment_feed:"1",board_id:o},function(){var o=document.getElementById("commentbox"+n);console.log(o);var t=o.offsetLeft-o.scrollLeft+o.clientLeft,a=o.offsetTop-o.scrollTop+o.clientTop;e.scrollTo(t,a-150),o.focus(),o.style.height="300px"})},t.feedclose=function(o){var t=document.getElementById("commentbox"+o),n=t.offsetLeft-t.scrollLeft+t.clientLeft,a=t.offsetTop-t.scrollTop+t.clientTop;e.scrollTo(n,a-150),t.focus(),t.style.height="50px"},t.post_comment_send=function(e){void 0===a.UID?alert("กรุณา Login ก่อนครับ"):(t.comment.board_id=e,t.comment.user_id=a.UID,t.comment.category="feedback",i.comment({comments:t.comment},function(){t.feedcomment(t.comment.board_id)}))}}]).controller("boardfaqCtrl",["$window","$rootScope","$scope","$location","$cookies","Board","socket",function(e,o,t,n,a,i,r){t.feedback={},t.comment={},t.detail_comment={};var l=n.path();t.faqfeed=i.feed({feedback_feed:"faq"}),t.path=l,t.reloadpage=function(){e.location.reload()},t.post_feedback_send=function(){console.log(t.feedback),t.feedback.user_id=a.UID,t.feedback.category="faq",void 0===t.feedback.user_id?alert("กรุณา Login ก่อนครับ"):i.create({feedback:t.feedback},function(e){alert(e.status),r.emit("Boardupdate",a.UID)})},t.feedcomment=function(o,n){t.detail_comment=i.feed({comment_feed:"1",board_id:o},function(){var t=document.getElementById("commentbox"+n);console.log(t),console.log(n),console.log(o);var a=t.offsetLeft-t.scrollLeft+t.clientLeft,i=t.offsetTop-t.scrollTop+t.clientTop;e.scrollTo(a,i-150),t.focus(),t.style.height="300px"})},t.feedclose=function(o){var t=document.getElementById("commentbox"+o),n=t.offsetLeft-t.scrollLeft+t.clientLeft,a=t.offsetTop-t.scrollTop+t.clientTop;e.scrollTo(n,a-150),t.focus(),t.style.height="50px"},t.post_comment_send=function(e){void 0===a.UID?alert("กรุณา Login ก่อนครับ"):(t.comment.board_id=e,t.comment.user_id=a.UID,t.comment.category="feedback",i.comment({comments:t.comment},function(){t.feedcomment(t.comment.board_id)}))}}]).controller("loginCtrl",["$window","$rootScope",function(){}]).controller("memberCtrl",["$scope","$rootScope","$window","$cookies","$route","$routeParams","$location","Uploadprofilepic","Filtermain","Member","CreateProperty","Notificationowner","Paypal","Userpayment","Favoritboard","PasswordChange","User","socket","Myads","Info","Duplicate",function(e,o,t,n,a,i,r,l,c,s,d,p,m,u,g,f,h,y,_,v,b){o.heading,o.pitch,e.error_alert=function(e,t){o.closed=!1,document.getElementById("error_containner").className="modal__upload",document.getElementById("errtitle").innerHTML=e,document.getElementById("errmessage").innerHTML=t},o.close_error_modal=function(){document.getElementById("error_containner").className="modal__upload hidden__div"},e.resetpin=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(o){var t=new google.maps.LatLng(o.coords.latitude,o.coords.longitude);console.log(t),e.map.setCenter(t)}):alert("กรุณาเปิด GPS ด้วยนะ")};try{void 0!==n.Email||"/homes"===r.path()}catch(w){console.log(w),"/homes"===r.path()}e.duplicatestatus=!1,e.ctrl="index",e.noticficationCounter=0,e.favoritboard=g.get({}),e.notificationowner=p.get({}),e.show_aprt=!0;var k=0;e.up={},e.profile_edit=!0,e.profile_myprofile=!1,e.preview_on_upgrade=!1,e.cre_ads=!1,e.show_customers=!0,e.reset_pas={},e.user={},e.balance=n.Balance,e.disObj=[];var I=[],$="image/icon/map_pin.png";e.distances=[],_.query({id:n.UID},function(o){e.adslist=o}),5==o.permissionGlobal?c.query({permission:n.UID},function(o){e.list=o}):c.query({all:n.UID},function(o){e.list=o}),void 0===n.Tel&&void 0===n.Email||(""!==n.Tel&&""===n.Email?h.query({tel:n.Tel},function(o){null!==o&&(e.user=o)}):""===n.Tel&&""!==n.Email?h.query({email:n.Email},function(o){null!==o&&(e.user=o)}):h.query({tel:n.Tel},function(o){null!==o&&(e.user=o)}));var L=new FormData;u.query({user_id:n.UID},function(o){e.userpayment=o}),e.$on("$routeChangeSuccess",function(){if("/controlpanel"===r.path())try{e.ctrl=n.Choosemenu}catch(o){e.ctrl="index",console.log(o)}}),y.on("Adsclicked",function(){var o=t.setInterval(function(){_.query({id:n.UID},function(o){e.adslist=o}),clearTimeout(o)},1500)}),y.on("Notice",function(o){if("admin"===o)var a=t.setInterval(function(){5==n.Permission?p.get({owner_id:"admin"},function(o){e.noticficationCounter=o.notice}):p.get({owner_id:n.UID},function(o){e.noticficationCounter=o.notice}),clearTimeout(a)},1e3);else o===n.UID}),e.changePassword=function(){""!==n.Email&&""!==n.Tel?(e.reset_pas.key=n.Email,f.post({reset:e.reset_pas},function(o){console.log(o),"1"===o.status?e.error_alert("เย้","Password ถูกเปลี่ยนเรียบร้อยแล้ว<br>"):e.error_alert("แย่จัง","ไม่สามารถเปลี่ยน Password ได้ Password เดิมที่ให้มาถูกหรือเปล่า?<br>")})):""===n.Email&&""!==n.Tel?(e.reset_pas.key=n.Tel,f.post({reset:e.reset_pas},function(o){"1"===o.status?e.error_alert("เย้","Password ถูกเปลี่ยนเรียบร้อยแล้ว<br>"):e.error_alert("แย่จัง","ไม่สามารถเปลี่ยน Password ได้ Password เดิมที่ให้มาถูกหรือเปล่า?<br>")})):""!==n.Email&&""===n.Tel&&(e.reset_pas.key=n.Email,f.post({reset:e.reset_pas},function(o){"1"===o.status?e.error_alert("เย้","Password ถูกเปลี่ยนเรียบร้อยแล้ว<br>"):e.error_alert("แย่จัง","ไม่สามารถเปลี่ยน Password ได้ Password เดิมที่ให้มาถูกหรือเปล่า?<br>")}))},e.save_notification=function(){e.txt={},e.txt._id=n.UID,void 0!==e.choose&&(e.txt.element=e.choose,s.post({text:e.txt},function(e){e&&(alert("บันทึกข้อมูลสำเร็จ"),o.checkPermission())}))},e.paymenttransaction=function(e){t.open("/paypal?price="+e+"&user_id="+n.UID,"_blank")},e.edit_apartment_detail=function(t){v.query({_id:t},function(t){e.add_aprt="add",e.up=t,console.log(t),e.isDuplicate(),e.findzip(),delete n.lat,delete n.lng,e.up.district=t.district,o.location=t.location,o.heading=t.heading,o.pitch=t.pitch,e.up.amphur=t.amphur,e.up.province=t.province,e.setzipcodeform(e.up.district,e.up.amphur),e.up.electric_bill=parseInt(e.up.electric_bill),e.up.heading=parseInt(e.up.heading),e.up.no_building=parseInt(e.up.no_building),e.up.no_room=parseInt(e.up.no_room),e.up.heading=parseInt(e.up.heading),e.up.pitch=parseInt(e.up.pitch),e.up.price_min=parseInt(e.up.price_min),e.up.price_max=parseInt(e.up.price_max),e.up.utility=parseInt(e.up.utility),e.up.water_bill=parseInt(e.up.water_bill),e.add_apart_init()})},void 0!==i.id&&e.edit_apartment_detail(i.id),e.isDuplicate=function(){b.query({namespace:e.up.namespace},function(o){if(o.status)e.duplicatestatus=!1;else try{o.data&&o.data._id!==e.up._id.toString()?(e.register.namespace.$error.pattern=!0,e.duplicatestatus=!0):e.duplicatestatus=!1}catch(t){e.duplicatestatus=!0,console.log(e.duplicatestatus),console.log(t)}})},e.removeproperty=function(o){confirm("Are you sure?")&&v.kill({_id:o},function(){c.query({all:n.UID},function(o){e.list=o})})},o.setCC=function(e){n.Choosemenu=e,o.ctrl=e,r.path("/controlpanel"),r.replace(),a.reload()},o.setCC=function(i,l){if(console.log("----------------"),o.ctrl=i,r.search("_id",l),"ads"===i)var c=t.setInterval(function(){_.query({id:n.UID},function(o){e.adslist=o}),clearTimeout(c)},1e3);n.Choosemenu!==i&&(n.Choosemenu=i,r.path("/controlpanel"),r.replace(),a.reload())},e.displaypreview=function(o){L=new FormData,console.log("----------------"),document.getElementById("displaypreviews").innerHTML="";for(var t,a=0;t=o.files[a];a++)if(t.type.match("image.*"))if(o.files[0].size/1e3<250)if(console.log(o.files[0].name.split(".").pop().toLowerCase()),"jpg"===o.files[0].name.split(".").pop().toLowerCase()||"jpeg"===o.files[0].name.split(".").pop().toLowerCase()||"png"===o.files[0].name.split(".").pop().toLowerCase()||"gif"===o.files[0].name.split(".").pop().toLowerCase()){L.append("profilepic",o.files[a]),L.append("user_id",n.UID);var i=new FileReader;i.onload=function(){return function(e){document.getElementById("displaypreviews").src=e.target.result;var o=new XMLHttpRequest;o.upload.onprogress=function(e){document.getElementById("process_bar_containner").className="modal__upload";var o=e.loaded/e.total*100;document.getElementById("process_bar").style.width=o+"%",console.log(o)},o.onload=function(){200==o.status?document.getElementById("process_bar_containner").className="modal__upload hidden__div":alert("Error! Upload failed")},o.onerror=function(){alert("Error! Upload failed. Can not connect to server.")},o.open("POST","/uploadprofilepic"),o.send(L)}}(t),i.readAsDataURL(t)}else e.error_alert("อัพโหลดผิดพลาด","นามสกุลไฟล์ไม่ถูกนะ : "+o.files[0].name);else e.error_alert("อัพโหลดผิดพลาด","ไฟล์ขนาดเกิน 250kb นะ ดูสิ  "+o.files[0].name+":"+o.files[0].size/1e3+"KB");else e.error_alert("อัพโหลดผิดพลาด","นามสกุลไฟล์ไม่ถูกนะ")},e.previewdraganddrop=function(e){document.getElementById("Previewzone").innerHTML="";for(var o,t=0;o=e.files[t];t++)if(o.type.match("image.*")){L.append("photogal",e.files[t]);var n=new FileReader;n.onload=function(){return function(e){var o=new Image(200,0);o.src=e.target.result,document.getElementById("Previewzone").appendChild(o)}}(o),n.readAsDataURL(o)}},e.add_apart_init=function(){var n=t.setInterval(function(){e.map||o.$broadcast("capstreetMap",!0),clearTimeout(n)},700)},e.initNMAP=function(){o.$broadcast("mapReady",!0)},e.initPMAP=function(){o.$broadcast("capstreetMap",!0)},e.$on("capstreetMap",function(){e.distances=[];navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){var a;o.location?a=new google.maps.LatLng(o.location[1],o.location[0]):void 0===n.lat?(a=new google.maps.LatLng(t.coords.latitude,t.coords.longitude),o.location=[],o.location[0]=t.coords.longitude,o.location[1]=t.coords.latitude):a=new google.maps.LatLng(n.lat,n.lng);var i;console.log(o.heading),console.log(o.pitch),i=void 0!==o.heading?{position:a,pov:{heading:parseInt(o.heading),pitch:parseInt(o.pitch)},scrollwheel:!1,zoom:1}:{position:a,pov:{heading:270,pitch:0},scrollwheel:!1,zoom:1},e.map=new google.maps.StreetViewPanorama(document.getElementById("map-canvas"),i),e.map.setVisible(!0),google.maps.event.addListener(e.map,"pov_changed",function(){e.up.heading=parseInt(e.map.getPov().heading),e.up.pitch=parseInt(e.map.getPov().pitch),o.heading=parseInt(e.map.getPov().heading),o.pitch=parseInt(e.map.getPov().pitch),console.log(e.up.heading+"      :      "+e.up.pitch)}),null==n.lat},function(){e.handleNoGeolocation(!0)}):e.handleNoGeolocation(!1)}),e.add_customers=function(){e.show_customers=!1};try{document.getElementById("overlay").style.visibility="hidden"}catch(w){}finally{e.profile_myprofile=!1,e.profile_upgrade=!0}e.send_mail=function(){e.reset_pas.email=n.Email,f.post({reset:e.reset_pas},function(e){console.log(e),alert(0==e[0]?"password ถูกเปลี่ยนเรียบร้อยแล้ว":"เกิดข้อผิดพลาดกรุณาลองใหม่ภายหลัง")})},e.add_aprt=function(){e.show_aprt=!1,o.$broadcast("mapReady",!0)},e.back_page_aprt=function(){e.show_aprt=!0,a.reload()},e.resend=function(){try{document.getElementById("overlay").style.visibility="visible"}catch(e){console.log(e)}finally{k++,o.loading=!0,1==k&&s.query({email:n.Email,hash:n.Hash},function(e){if(1==e[0])try{document.getElementById("overlay").style.visibility="hidden"}catch(t){}finally{o.loading=!1,k--,alert("กรุณายืนยันผู้ใช้ทาง Email \nหากยังไม่ได้รับ Email ยืนยัน \nกรุณาตรวจสอบในถังขยะ(junk mail)")}else try{document.getElementById("overlay").style.visibility="hidden"}catch(t){}finally{k--,alert("เกิดข้อผิดพลาด กรุณาติดต่อเจ้าหน้าที่")}})}},e.show_profile=function(){e.profile_myprofile=!1,e.profile_upgrade=!0,e.profile_edit=!0},e.show_upgrade=function(){e.initlist=new Array,o.$broadcast("mapReady",!0),0==n.Permission&&alert("กรุณายืนยันผู้ใช้ทาง Email ก่อนใช้งาน\nหากยังไม่ได้รับ Email ยืนยัน \nกรุณาตรวจสอบในถังขยะ(junk mail) \nหรือกด re active เพื่อนทำการส่ง Email ยืนยันใหม่")},e.show_edit_profile=function(){e.profile_edit=!1,e.profile_myprofile=!0},e.update=function(e,a){var i={},r=e;i.element={},i.element[r]=a,i._id=n.UID,s.post({text:i},function(e){1==e[0]&&("name"===r&&(delete n.Name,n.Name=a,o.user_name=n.Name,t.location.reload()),y.emit("PropertyUpdate",i))})},e.back_page=function(){e.profile_edit=!0,e.profile_myprofile=!1,e.cre_ads=!1,a.reload()},e.add_ads=function(){e.cre_ads=!0;var n=t.setInterval(function(){e.map||o.$broadcast("adsmapReady",!0),clearTimeout(n)},2e3)},e.logopreview=function(e){var o=e;try{for(var t,n=0;t=o.files[n];n++)if(t.type.match("image.*")){L.append("logo",e.files[n]);var a=new FileReader;a.onload=function(){return function(e){try{document.getElementById("adspv").style.backgroundImage="url('"+e.target.result+"')"}catch(e){}try{document.getElementById("logopreviewoncreateapartment").src=e.target.result,document.getElementById("logopreviewoncreateapartment2").src=e.target.result}catch(e){}}}(t),a.readAsDataURL(t)}else alert("นามสกุลไฟล์ไม่ถูกนะ : "+e.files[0].name)}catch(i){}},e.headerpreview=function(e){for(var o,t=e,n=0;o=t.files[n];n++)if(o.type.match("image.*")){L.append("header",e.files[n]);var a=new FileReader;a.onload=function(){return function(e){document.getElementById("headerpreviewoncreateapartment").style.backgroundImage="url('"+e.target.result+"')",document.getElementById("headerpreviewoncreateapartment2").src=e.target.result}}(o),a.readAsDataURL(o)}else alert("นามสกุลไฟล์ไม่ถูกนะ : "+e.files[0].name)},e.upgrade=function(){e.up.user_id=n.UID,console.log(e.up.heading+"    :    "+e.up.pitch),console.log(o.heading+"    :    "+o.pitch),d.post({property:e.up},function(t){if(e.statUp=t,void 0!==t._id&&L){try{L.append("user_id",n.UID),L.append("id",t._id);var a=new XMLHttpRequest;a.upload.onprogress=function(o){document.getElementById("process_bar_containner").className="modal__upload";var t=o.loaded/o.total*100;document.getElementById("process_bar").style.width=t+"%",100==t&&(document.getElementById("process_bar_containner").className="modal__upload hidden__div",e.add_aprt="show"),console.log(t)},a.onload=function(){200==a.status?document.getElementById("process_bar_containner").className="modal__upload hidden__div":(document.getElementById("process_bar_containner").className="modal__upload hidden__div",alert("Error! Upload failed"))},a.onerror=function(){alert("Error! Upload failed. Can not connect to server.")},a.open("POST","/uploadpic"),a.send(L)}catch(i){}finally{e.up={},o.setCC("manage")}c.query({all:n.UID},function(o){e.list=o})}else o.setCC("manage")})},t.initMap=function(){e.initlist=new Array},e.nearbysearch=function(){var t=[];e.disObj=[],angular.forEach(e.choose,function(e){0!=e&&t.push(e)});var n=new google.maps.LatLng(e.map.center.lat(),e.map.center.lng()),a={location:n,radius:1e3*e.chooses.radius,types:t};e.service=new google.maps.places.PlacesService(e.map),e.service.nearbySearch(a,function(n){e.nearbyPlaces=n,t=[];for(var a=e.nearbyPlaces.length-1;a>=0;a--)e.disObj.push(o.distance(e.nearbyPlaces[a].geometry.location.k,e.nearbyPlaces[a].geometry.location.B,e.map.center.lat(),e.map.center.lng(),""));e.$apply()})},e.condos=[],e.$on("mapReady",function(){try{var t={zoom:14,scrollwheel:!1,disableDoubleClickZoom:!0};e.map=new google.maps.Map(document.getElementById("map-canvas"),t),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){var a;a=o.location?new google.maps.LatLng(o.location[1],o.location[0]):void 0===n.lat?new google.maps.LatLng(t.coords.latitude,t.coords.longitude):new google.maps.LatLng(n.lat,n.lng),e.marker=new google.maps.Marker({position:a,title:"Your Location",draggable:!0,icon:$}),google.maps.event.addListener(e.map,"center_changed",function(){var t=new google.maps.LatLng(e.map.center.lat(),e.map.center.lng());n.lat=e.map.center.lat(),n.lng=e.map.center.lng(),o.location=[],e.up.location=[],e.up.location[1]=e.map.center.lat(),e.up.location[0]=e.map.center.lng(),o.location[1]=e.map.center.lat(),o.location[0]=e.map.center.lng(),e.marker.setPosition(t)}),google.maps.event.addListener(e.marker,"dragend",function(t){for(var a=0;a<I.length;a++)I[a].setMap(null);n.lat=t.latLng.lat(),n.lng=t.latLng.lng(),e.up.location=[],o.location=[],e.up.location[1]=t.latLng.lat(),e.up.location[0]=t.latLng.lng(),o.location[1]=t.latLng.lat(),o.location[0]=t.latLng.lng();var i=new google.maps.LatLng(n.lat,n.lng);e.map.setCenter(i)}),e.marker.setMap(e.map),e.map.setCenter(a),null==n.lat},function(){e.handleNoGeolocation(!0)}):e.handleNoGeolocation(!1)}catch(a){}}),e.handleNoGeolocation=function(o){if(o)var t="Error: The Geolocation service failed. Please click on the map to change location.";else var t="Error: Your browser doesn't support geolocation. Please click on the map to change location.";{var n={map:e.map,position:new google.maps.LatLng(13.883661700000001,100.5698831),content:t};new google.maps.InfoWindow(n)}e.map.setCenter(n.position),e.showMeTheCondo(n.position)}}]).controller("infoCtrl",["$rootScope","$scope","$routeParams","$window","$sce","$route","$cookies","Info","CustomerPropertyOwner","Property",function(e,o,t,n,a,i,r,l,c,s){o.$on("$routeChangeSuccess",function(){o.initlist=new Array,document.getElementById("map-canvas").innerHTML="";for(var n=15e3;n>=0;n--)if(0==n){var i;i=t._id,l.query({_id:i},function(t){o.property=t,o.property.detail=a.trustAsHtml(t.detail),o.property.about=a.trustAsHtml(t.about),o.property.room_detail=a.trustAsHtml(t.room_detail),console.log(t),s.query({location:o.property.location},function(e){o.nearby=e,console.log("nearby"),console.log(o.nearby)}),e.$broadcast("StreatviewReady",!0)})}});var d=[];o.currentIndex=0,o._Index=0,o.addType=function(){d=[];var t=0;angular.forEach(o.choose,function(e){t++,e===!1||d.push(e)}),e.$broadcast("infoMapReady",!0)},o.setCurrentSlideIndex=function(e){o.currentIndex=e},o.isCurrentSlideIndex=function(e){return o.currentIndex===e},o.prevSlide=function(){o.currentIndex=o.currentIndex<o.property.images.length-1?++o.currentIndex:0},o.nextSlide=function(){o.currentIndex=o.currentIndex>0?--o.currentIndex:o.property.images.length-1},o.onClickTab=function(e){o.currentTab=e.url},o.isActiveTab=function(e){return e==o.currentTab},o.isActive=function(e){return o._Index===e},o.showPrev=function(){o._Index=o._Index>0?--o._Index:o.property.images.length-1},o.showNext=function(){console.log("next"),o._Index=o._Index<o.property.images.length-1?++o._Index:0},o.showPhoto=function(e){o._Index=e};var p=[],m=[],u="image/icon/map_pin.png";o.customerowner=c.get({customerId:"0001"}),n.initMap=function(){o.initlist=new Array,e.$broadcast("StreatviewReady",!0)},o.infoinitNMAP=function(){o.initlist=new Array,e.$broadcast("infoMapReady",!0)},o.infoinitPMAP=function(){o.initlist=new Array,document.getElementById("map-canvas").innerHTML="",e.$broadcast("StreatviewReady",!0)},o.condos=[],o.$on("StreatviewReady",function(){console.log("info map called"),o.distances=[],console.log(o.property.heading);navigator.geolocation?navigator.geolocation.getCurrentPosition(function(){var t=new google.maps.LatLng(o.property.location[1],o.property.location[0]),n={position:t,pov:{heading:parseFloat(o.property.heading),pitch:parseFloat(o.property.pitch)},scrollwheel:!1,zoom:1};console.log(o.property.heading),console.log(o.property.pitch),console.log(n);var a={location:t,radius:"1500",types:d};o.map=new google.maps.Map(document.getElementById("map-canvas"),{center:t,zoom:12,scrollwheel:!1});var i=o.map.center.lat(),l=o.map.center.lng();o.service=new google.maps.places.PlacesService(o.map),o.service.nearbySearch(a,function(t){o.$apply();for(var n=t.length-1;n>=0;n--)t[n].distances=e.distance(t[n].geometry.location.k,t[n].geometry.location.B,i,l,"");o.nearbyPlaces=t,o.$apply()}),o.map=new google.maps.StreetViewPanorama(document.getElementById("map-canvas"),n),o.map.setVisible(!0),null==r.lat},function(){o.handleNoGeolocation(!0)}):o.handleNoGeolocation(!1)}),o.$on("infoMapReady",function(){console.log("info map called");var t={zoom:13,scrollwheel:!1,disableDoubleClickZoom:!0};o.map=new google.maps.Map(document.getElementById("map-canvas"),t),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){var n=new google.maps.LatLng(o.property.location[1],o.property.location[0]),a=new google.maps.Marker({position:n,title:"Your Location",draggable:!1,icon:u});a.setMap(o.map),o.map.setCenter(n);var i={location:n,radius:"1500",types:d},l=o.map.center.lat(),c=o.map.center.lng();o.service=new google.maps.places.PlacesService(o.map),o.service.nearbySearch(i,function(t){o.$apply(),console.log(t);for(var n=t.length-1;n>=0;n--){var a;a="pharmacy"===t[n].types[0]?{url:"/css/image/icon/pin/p4.png"}:"subway_station"===t[n].types[0]?{url:"/css/image/icon/pin/p10.png"}:"bank"===t[n].types[0]?{url:"/css/image/icon/pin/p5.png"}:"department_store"===t[n].types[0]?{url:"/css/image/icon/pin/p6.png"}:"movie_theater"===t[n].types[0]?{url:"/css/image/icon/pin/p6.png"}:"restaurant"===t[n].types[0]?{url:"/css/image/icon/pin/p1.png"}:"food"===t[n].types[0]?{url:"/css/image/icon/pin/p1.png"}:"school"===t[n].types[0]?{url:"/css/image/icon/pin/p8.png"}:{url:"/css/image/icon/pin/p3.png"},t[n].distances=e.distance(t[n].geometry.location.k,t[n].geometry.location.B,l,c,"");var i=new google.maps.LatLng(t[n].geometry.location.k,t[n].geometry.location.B),r=new google.maps.Marker({position:i,title:t[n].name,icon:a});m.push(r),r.setMap(o.map);var s=t[n].name;o.attachInfo(r,s)}}),null==r.lat&&o.showMeTheCondo(t)},function(){o.handleNoGeolocation(!0)}):o.handleNoGeolocation(!1)}),o.handleNoGeolocation=function(e){if(e)var t="Error: The Geolocation service failed. Please click on the map to change location.";else var t="Error: Your browser doesn't support geolocation. Please click on the map to change location.";{var n={map:o.map,position:new google.maps.LatLng(13.883661700000001,100.5698831),content:t};new google.maps.InfoWindow(n)}o.map.setCenter(n.position),o.showMeTheCondo(n.position)},o.attachInfo=function(e,o){var t=new google.maps.InfoWindow({content:o});p.push(t),google.maps.event.addListener(e,"click",function(){for(var o=0;o<p.length;o++)p[o].close();t.open(e.get("map"),e)})}}]).controller("fmCtrl",["$scope","Filtermain","$window","$rootScope",function(){}]).controller("searchresultCtrl",["$scope","$window","$http","$rootScope","$route","$location","$cookies","Search","socket","Property",function(e,o,t,n,a,i,r,l,c,s){e.temp={},n.customershow=!0,e.pagination=1,e.currentPage=1,e.pageSize=10,e.gotoPage=1,e.maptype=0,e.searchoption=1;var d={};e.markerarray=[],e.infoarray=[],e.reads=function(o){e.foundApartment(o,e.maptype)},e.settxt=function(){if(console.log(e.currentPage),n.searchtxt=e.search,console.log(n.searchtxt),console.log(i.path()),"/homes"===i.path())n.customershow=!0,""===n.searchtxt?(n.managesearch=!1,document.getElementById("searchnotfix").focus()):(n.managesearch=!0,document.getElementById("searchfix").focus(),document.getElementById("searchfix").click());else if("/result"===i.path()){n.customershow=!0;{n.searchtxt}e.txtsearch()}else n.customershow="/my_page"===i.path()?!1:!0},o.initMap=function(){"result"===i.path()?e.map||n.$broadcast("searchMapReady",!0):n.$broadcast("mapReady",!0)},e.$on("$routeChangeSuccess",function(){if("/homes"===i.path())n.managesearch=!1;else if("/result"===i.path()){e.timercount=0,e.timersection=0,e.loadigtimer=o.setInterval(function(){console.log(e.timercount),e.timercount>=0&&1==e.timersection?0==e.timercount?(e.timercount++,e.timersection=0):e.timercount--:e.timercount<=100&&0==e.timersection&&(100==e.timercount?(e.timercount--,e.timersection=1):e.timercount++),document.getElementById("process_bar").style.width=e.timercount+"%"},10),document.getElementById("process_bar_containner").className="modal__upload";var t=o.setInterval(function(){e.map?e.foundApartment():(console.log("gen map"),n.$broadcast("searchMapReady",!0)),e.settxt(),e.txtsearch(),clearTimeout(t)},2e3);n.managesearch=!0}else n.managesearch=!0}),e.selectedAddress="",e.geocode=function(){},e.getId=function(e){return e._id},e.$watch("temp",function(o){d={},angular.forEach(o,function(o){d[e.getId(o)]=o}),e.temp=[];var t=0;angular.forEach(d,function(o){e.temp[t]=o,t++}),e.pagination=Math.ceil(o.length/10),e.numberOfPages=function(){return Math.ceil(o.length/e.pageSize)},clearTimeout(e.loadigtimer),document.getElementById("process_bar_containner").className="modal__upload hidden__div"
},!0),e.initNMAP=function(){e.searchoption=0,n.$broadcast("pinMapReady",!0)},e.initPMAP=function(){e.searchoption=1,n.$broadcast("searchMapReady",!0)},e.txtsearch=function(){n.searchtxt=e.search,""!==e.search&&(1==e.searchoption?l.query({search:e.search},function(o){n.$broadcast("searchMapReady",!0),e.temp=[],angular.forEach(o,function(o){e.temp.push(o)})}):e.geocoder.geocode({address:e.search},function(o,t){if(t==google.maps.GeocoderStatus.OK){e.map.setCenter(o[0].geometry.location),e.marker.setPosition(o[0].geometry.location);for(var n=0;n<e.markerarray.length;n++)null!=e.markerarray[n]&&e.markerarray[n].setMap(null);e.temp=[],e.foundApartment(1,1)}}))},e.push=function(){document.getElementById("map-canvas").innerHTML=""},e.$on("pinMapReady",function(){try{document.getElementById("map-canvas").innerHTML="";try{e.map.$destroy()}catch(o){}finally{e.maptype=1;var t,n="image/icon/map_pin.png",a={zoom:10,scrollwheel:!1,disableDoubleClickZoom:!0};e.geocoder=new google.maps.Geocoder,e.map=new google.maps.Map(document.getElementById("map-canvas"),a),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(o){t=void 0===r.lat?new google.maps.LatLng(o.coords.latitude,o.coords.longitude):new google.maps.LatLng(r.lat,r.lng),e.marker=new google.maps.Marker({position:t,title:"Your Location",draggable:!0,icon:n}),google.maps.event.addListener(e.marker,"dragend",function(o){for(var t=0;t<e.markerarray.length;t++)null!=e.markerarray[t]&&e.markerarray[t].setMap(null);r.lat=o.latLng.lat(),r.lng=o.latLng.lng();var n=new google.maps.LatLng(r.lat,r.lng);e.map.setCenter(n),e.temp=[],e.foundApartment(1,1)}),e.marker.setMap(e.map),e.currentPage=1,e.map.setCenter(t),e.foundApartment(1,1),null==r.lat},function(){e.handleNoGeolocation(!0)}):e.handleNoGeolocation(!1)}}catch(o){}}),e.$on("searchMapReady",function(){try{document.getElementById("map-canvas").innerHTML="";try{e.map.$destroy()}catch(o){}finally{e.maptype=0;var t={zoom:5,scrollwheel:!1,disableDoubleClickZoom:!0};e.geocoder=new google.maps.Geocoder,e.map=new google.maps.Map(document.getElementById("map-canvas"),t),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(o){if(void 0==r.lat)var t=new google.maps.LatLng(o.coords.latitude,o.coords.longitude);else var t=new google.maps.LatLng(r.lat,r.lng);e.currentPage=1,e.map.setCenter(t),e.foundApartment(1,e.maptype),e.$apply(),null==r.lat},function(){e.handleNoGeolocation(!0)}):e.handleNoGeolocation(!1)}}catch(o){}}),e.foundApartment=function(o,t){try{for(var n=0;n<e.markerarray.length;n++)null!=e.markerarray[n]&&null!=e.markerarray[n]&&e.markerarray[n].setMap(null)}catch(a){}finally{e.markerarray=[],e.infoarray=[];for(var i,l=[],n=9;n>=0;n--)l[n]="/css/image/icon/pin/pin"+(n+1)+".png";var n=1;0==t?angular.forEach(e.temp,function(t){try{var a=new google.maps.LatLng(t.location[1],t.location[0]);10*o>=n&&n>10*(o-1)?(i=new google.maps.Marker({position:a,title:t.title,icon:l[n-10*(o-1)-1],zIndex:999}),google.maps.event.addListener(i,"mouseover",function(){for(var e=document.getElementsByClassName("pincontent"),o=e.length-1;o>=0;o--)e[o].id==t._id||(e[o].style.display="none")}),google.maps.event.addListener(i,"mouseout",function(){for(var e=document.getElementsByClassName("pincontent"),o=e.length-1;o>=0;o--)e[o].style.display=""}),n++):n++,e.markerarray.push(i),i.setMap(e.map);var r='<a href="#!/info?_id='+t._id+'"  style="font-size:1em;" target="_blank">'+t.title+'</a> <p class="profile--p">ค่าเช่า'+t.price+' บาท</p><br> <img style="width:100px;" src="'+t.images[0]+'"/>';e.attachInfo(i,r)}catch(c){console.log(c)}}):s.query({location:[r.lng,r.lat]},function(o){angular.forEach(o,function(o){e.temp.push(o.obj)});for(var t=[],n=9;n>=0;n--)t[n]="/css/image/icon/pin/pin"+(n+1)+".png";for(var n=0;n<o.length;n++){var a,i=new google.maps.LatLng(o[n].obj.location[1],o[n].obj.location[0]);10>=n?(a=new google.maps.Marker({position:i,title:o[n].obj.title,icon:t[n]}),google.maps.event.addListener(a,"mouseover",function(){for(var o=document.getElementsByClassName("pincontent"),t=o.length-1;t>=0;t--)o[t].id==e.temp[t]._id||(o[t].style.display="none")}),google.maps.event.addListener(a,"mouseout",function(){for(var e=document.getElementsByClassName("pincontent"),o=e.length-1;o>=0;o--)e[o].style.display=""})):a=new google.maps.Marker({position:i,title:o[n].obj.title}),e.markerarray.push(a),a.setMap(e.map);var r='<a href="#!/info?_id='+o[n].obj._id+'"  style="font-size:1em;" target="_blank">'+o[n].obj.title+'</a> <p class="profile--p">ค่าเช่า'+o[n].obj.price+' บาท</p><br> <img style="width:100px;" src="'+o[n].obj.images[0]+'"/>';e.attachInfo(a,r)}})}},e.attachInfo=function(o,t){var n=new google.maps.InfoWindow({content:t});e.infoarray.push(n),google.maps.event.addListener(o,"click",function(){for(var t=0;t<e.infoarray.length;t++)e.infoarray[t].close();n.open(o.get("map"),o)})},c.on("PropertyUpdate",function(o){for(var t=e.temp.length-1;t>=0;t--)e.temp[t]._id.toString()===o._id.toString()&&(e.temp[t].title=o.element.title)})}]).controller("sponsorCtrl",["$scope","Myads","$location","$http","$rootScope","$window","$cookies","socket","GotoInfo",function(e,o,t,n,a,i,r,l,c){o.query({lat:r.lat,lng:r.lng},function(o){e.sort=[],e.sponsor=o;for(var t in e.sponsor)void 0!==e.sponsor[t].dis&&(e.sponsor[t].dis=e.sponsor[t].dis/e.sponsor[t].obj.cpc);for(var t in e.sponsor)try{0===e.sponsor[t].obj.ads_status&&e.sort.push(e.sponsor[t])}catch(n){}e.sponsor=e.sort}),e.clicked=function(e,o){l.emit("Adsclick",e),i.location="#!/info?_id="+o,c.post({_id:e},function(){})}}]).controller("customerPageCtrl",["$q","$scope","$window","$sce","$rootScope","Propertys","$routeParams","$filter","$cookies","$location","Filter","socket",function(e,o,t,n,a,i,r,l,c,s,d,p){var m="image/icon/map_pin.png",u=[];a.customershow="/page"==s.path()?!1:!0,o.list={},o.filter=[],o.tempList={};var g=r._id;d.query({_id:g},function(e){o.list=e,console.log("list"),console.log(o.list),o.list.about=n.trustAsHtml(e.about),o.list.detail=n.trustAsHtml(e.detail),o.list.room_detail=n.trustAsHtml(e.room_detail),o.statusList=o.showStatus(),o.statusSellList=o.showStatussl()}),o.showStatus=function(){for(var e=[],t=o.list.apartment.length-1;t>=0;t--)for(var n=o.type_txt.length-1;n>=0;n--)o.type_txt[n].value==o.list.apartment[t]&&e.push(o.type_txt[n].text);return e.length?e.join(", "):"Not set"},o.showStatussl=function(){var e=[];return angular.forEach(o.type_sl1,function(t){o.list.type_sell.indexOf(t.value)>=0&&e.push(t.text)}),e.length?e.join(", "):"Not set"},o.isActive=function(e){return o._Index===e},o.showPrev=function(){o._Index=o._Index>0?--o._Index:o.list.images.length-1},o.showNext=function(){console.log("next"),o._Index=o._Index<o.list.images.length-1?++o._Index:0},o.loadGroups=function(){return o.type_txt.length};o.update=function(e,o){var t={},n=e;t.element={},t.element[n]=o,t.uid=c.UID,t._id=r._id,p.emit("PropertyUpdate",t),i.post({text:t},function(){})},t.initMap=function(){o.initlist=new Array,a.$broadcast("customerStreatviewReady",!0)},o.customerinitmap=function(){o.initlist=new Array,a.$broadcast("customerMapReady",!0)},o.customerinitstreetview=function(){o.initlist=new Array,document.getElementById("map-canvas").innerHTML="",a.$broadcast("customerStreatviewReady",!0)},o.condos=[],o.$on("customerStreatviewReady",function(){console.log("info map called"),o.distances=[],console.log(o.list.heading);navigator.geolocation?navigator.geolocation.getCurrentPosition(function(){var e=new google.maps.LatLng(o.list.location[1],o.list.location[0]),t={position:e,pov:{heading:parseFloat(o.list.heading),pitch:parseFloat(o.list.pitch)},scrollwheel:!1,zoom:1};console.log(o.list.heading),console.log(o.list.pitch),console.log(t);var n={location:e,radius:"1500",types:u};o.map=new google.maps.Map(document.getElementById("map-canvas"),{center:e,zoom:12,scrollwheel:!1});var i=o.map.center.lat(),r=o.map.center.lng();o.service=new google.maps.places.PlacesService(o.map),o.service.nearbySearch(n,function(e){o.$apply();for(var t=e.length-1;t>=0;t--)e[t].distances=a.distance(e[t].geometry.location.k,e[t].geometry.location.B,i,r,"");o.nearbyPlaces=e,o.$apply()}),o.map=new google.maps.StreetViewPanorama(document.getElementById("map-canvas"),t),o.map.setVisible(!0),null==c.lat},function(){o.handleNoGeolocation(!0)}):o.handleNoGeolocation(!1)}),o.$on("customerMapReady",function(){var e={zoom:13,scrollwheel:!1,disableDoubleClickZoom:!0};o.map=new google.maps.Map(document.getElementById("map-canvas"),e),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var t=new google.maps.LatLng(o.list.location[1],o.list.location[0]),n=new google.maps.Marker({position:t,title:"Your Location",draggable:!1,icon:m});n.setMap(o.map),o.map.setCenter(t);var i={location:t,radius:"1500",types:u},r=o.map.center.lat(),l=o.map.center.lng();o.service=new google.maps.places.PlacesService(o.map),o.service.nearbySearch(i,function(e){o.$apply(),console.log(e);for(var t=e.length-1;t>=0;t--){var n;n="pharmacy"===e[t].types[0]?{url:"/css/image/icon/pin/p4.png"}:"subway_station"===e[t].types[0]?{url:"/css/image/icon/pin/p10.png"}:"bank"===e[t].types[0]?{url:"/css/image/icon/pin/p5.png"}:"department_store"===e[t].types[0]?{url:"/css/image/icon/pin/p6.png"}:"movie_theater"===e[t].types[0]?{url:"/css/image/icon/pin/p6.png"}:"restaurant"===e[t].types[0]?{url:"/css/image/icon/pin/p1.png"}:"food"===e[t].types[0]?{url:"/css/image/icon/pin/p1.png"}:"school"===e[t].types[0]?{url:"/css/image/icon/pin/p8.png"}:{url:"/css/image/icon/pin/p3.png"},e[t].distances=a.distance(e[t].geometry.location.k,e[t].geometry.location.B,r,l,"");var i=new google.maps.LatLng(e[t].geometry.location.k,e[t].geometry.location.B),c=new google.maps.Marker({position:i,title:e[t].name,icon:n});markerarray.push(c),c.setMap(o.map);var s=e[t].name;o.attachInfo(c,s)}}),null==c.lat&&o.showMeTheCondo(e)},function(){o.handleNoGeolocation(!0)}):o.handleNoGeolocation(!1)})}]).controller("Login",["$scope","$cookies","$rootScope","$location","$route","$window","Check","User",function(e,o,t,n,a,i,r,l){if(t.permissionGlobal=-1,t.loading=!1,t.checkPermission=function(){""!==o.Email&&""===o.Tel?l.query({email:o.Email},function(e){console.log("2034 controller.js"),console.log(e),e.email&&(o.Name=e.name,o.Email=e.email,o.Permission=e.permission,o.Hash=e.password,o.UID=e._id,o.Favoriteap=e.favoriteap,o.Balance=e.balance),void 0!==o.Name?(t.username=o.Name,t.permissionGlobal=o.Permission,n.replace()):(t.user_logout=!0,"/homes"===n.path()||"/info"===n.path()||"/result"===n.path())}):""!==o.Tel&&""===o.Email?l.query({tel:o.Tel},function(e){console.log("2074 controller.js"),console.log(e),e.email&&(o.Name=e.name,o.Email=e.email,o.Permission=e.permission,o.Hash=e.password,o.UID=e._id,o.Favoriteap=e.favoriteap,o.Balance=e.balance),void 0!==o.Name?(t.username=o.Name,t.permissionGlobal=o.Permission,n.replace()):(t.user_logout=!0,"/homes"===n.path()||"/info"===n.path()||"/result"===n.path())}):""!==o.Tel&&""!==o.Email?l.query({tel:o.Tel},function(e){console.log("2114 controller.js"),console.log(e),e.email&&(o.Name=e.name,o.Email=e.email,o.Permission=e.permission,o.Hash=e.password,o.UID=e._id,o.Favoriteap=e.favoriteap,o.Balance=e.balance),void 0!==o.Name?(t.username=o.Name,t.permissionGlobal=o.Permission,n.replace()):(t.user_logout=!0,"/homes"===n.path()||"/info"===n.path()||"/result"===n.path())}):(delete o.UID,delete o.Hash,delete o.Name,delete o.Permission,delete o.Email,delete o.Favoriteap,delete o.Choosemenu,delete o.Balance,t.permissionGlobal=-1,n.path("/homes"),n.replace())},o&&"undefined"!=typeof o)try{var c=o.Email;void 0!==c&&"undefined"!=typeof c&&(t.user_email=o.Email),0==o.Permission?t.user_stat="Standard User":1==o.Permissio?t.user_stat="Administrator":2==o.Permission&&(t.user_stat="VIP User"),t.user_name=o.Name!==o.Email?o.Name:"ยังไม่ได้ทำการตั้งชื่อ"}catch(s){}e.$on("$routeChangeSuccess",function(){void 0===o.Permission?"/controlpanel"===n.path():"/controlpanel"===n.path()}),t.checkPermission(),t.distance=function(e,o,t,n,a){var i=Math.PI*e/180,r=Math.PI*t/180,l=(Math.PI*o/180,Math.PI*n/180,o-n),c=Math.PI*l/180,s=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos(c);return s=Math.acos(s),s=180*s/Math.PI,s=60*s*1.1515,"M"==a&&(s=1.609344*s),"N"==a&&(s=.8684*s),s},e.logoutsend=function(){delete o.UID,delete o.Hash,delete o.Name,delete o.Permission,delete o.Email,delete o.Favoriteap,delete o.Choosemenu,delete o.Balance,delete o.Tel,t.permissionGlobal=-1,n.path("/homes"),n.replace()},e.loginsend=function(){r.query({username:e.login.username,password:e.login.password},function(a){void 0!==a.permission?(o.Tel=a.tel,o.Name=a.name,o.UID=a._id,o.Hash=a.password,o.Permission=a.permission,o.Email=a.email,o.Favoriteap=a.favoriteap,t.permissionGlobal=o.Permission,t.username=o.Name,e.displayCheckBox=!1,n.path("/homes"),n.replace()):alert("Please Check your username and password")})}}]).controller("customerdetailCtrl",["$scope","$cookies","$rootScope","Customer","CustomerProperty",function(e,o,t,n,a){e.customer=n.get({customerId:"0000"}),e.customerProperties=a.get({customerId:"00001"})}]).controller("adminCtrl",["$scope","$cookies","$rootScope","Check","dateFilter","Userlist",function(e,o,t,n,a,i){e.date_visit=a(new Date,"yyyy-MM-dd"),e.date_appointment=a(new Date,"yyyy-MM-dd"),e.minDate="2014-01-01",e.maxDate="2020-12-30",e.time_visit="",e.time_appointment="",i.query({saleman:"1"},function(o){e.salelist=o})}]).controller("resetpassCtrl",["$scope","$cookies","$rootScope","$routeParams","$location","PasswordChange",function(e,o,t,n,a,i){e.forget_email,e.reset=!0;try{document.getElementById("overlay").style.visibility="hidden"}catch(r){console.log(r)}finally{e.reset=void 0!==n.token?!1:!0}e.send_mail=function(){try{document.getElementById("overlay").style.visibility="visible"}catch(o){}finally{i.query({email:e.forget_email},function(e){if(1==e[0])try{document.getElementById("overlay").style.visibility="hidden"}catch(o){console.log(o)}finally{alert("กรุณาตรวจสอบ Email เพื่อทำการเปลี่ยนรหัสผ่าน ")}else if(void 0===e[0])try{document.getElementById("overlay").style.visibility="hidden"}catch(o){console.log(o)}finally{alert("ไม่มี Email นี้ในระบบ")}})}},e.changePassword=function(){e.reset_pas.token=n.token,e.reset_pas.email=n.email,i.post({reset:e.reset_pas},function(e){alert(null!=e?"Password ถูกเปลี่ยนเรียบร้อยแล้ว":"ไม่สามารถเปลี่ยน Password ได้ กรุณาใช้ Link ที่ระบบส่งให้!")})}}]).controller("controlpanelCtrl",["$scope","$cookies","$rootScope","$window","Check",function(){}]).controller("regisCtrl",["$scope","$http","$window","$cookies","$rootScope","$location","User","Check",function(e,o,t,n,a,i,r,l){e.reg={},e.passupdate=function(){e.password=e.reg.password},e.patternupdate=function(){var o=new RegExp("^"+e.password+"$","");return o},e.smsCheck=function(){e.reg.tel.length>8?e.reg.tel.search(/^[0-9]*$/)?e.isValid=!1:(e.isValid=!0,console.log("yeah")):e.isValid=!1},e.userCheck=function(){e.check_valid="",e.reg.tel="",e.reg.email="",e.check_invalid="",e.check_valid="",e.check_invalid="";try{e.isValid=!0,e.reg.mailortel.search(/^[0-9]*$/)?e.reg.mailortel.search(/[\S]+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$/)?(e.isValid=!1,e.check_invalid="กรุณาเช็ค Email หรือเบอร์โทรศัพท์ด้วยนะว่าถูกต้องหรือไม่?"):(e.reg.email=e.reg.mailortel,r.query({email:e.reg.email},function(o){void 0!==o.permission?(e.check_invalid="มีผู้ใช้ "+e.reg.mailortel+" ในระบบแล้วนะ ลอง email อื่นใหม",e.isValid=!1):e.check_valid="คุณสามารถใช้ "+e.reg.email+" ในการสมัคร email นี้จะจำเป็นหากต้องการยืนยันสมาชิกนะ"})):10==e.reg.mailortel.length?(e.reg.tel=e.reg.mailortel,r.query({tel:e.reg.tel},function(o){void 0!==o.permission?(e.check_invalid="มีผู้ใช้ "+e.reg.mailortel+" ในระบบแล้วนะ ลองเบอร์อื่นใหม",e.isValid=!1):e.check_valid="เอ๊ะ คุณแน่ใจแล้วหรือที่จะใช้ "+e.reg.mailortel+" ในการสมัคร เบอร์นี้อาจจะจำเป็นต้องใช้ในการยืนยันสมาชิกทาง SMS นะ"})):(e.isValid=!1,e.check_invalid="กรุณาเช็ค Email หรือเบอร์โทรศัพท์ด้วยนะว่าถูกต้องหรือไม่?")}catch(o){}},e.isValid=!1,e.next=function(){},e.update=function(){r.post({reg:e.reg},function(o){"1"===o[0]&&l.query({username:e.reg.mailortel,password:e.reg.password},function(o){n.Tel=o.tel,n.UID=o._id,n.Hash=o.password,n.Permission=o.permission,n.Email=o.email,n.Name=o.email,n.Favoriteap=o.favoriteap,a.controlpanel__apartment=!0,a.controlpanel__profile=!1,a.controlpanel__ads=!0,a.controlpanel__blog=!0,a.controlpanel__report=!0,a.controlpanel__security=!0,e.displayCheckBox=!1,t.location="/#!/controlpanel",alert("Please activate your account in your mailbox"),console.log("2016 ctrljs"),console.log(o),void 0!==o.permission?(n.Name=void 0===o.name?o.tel:o.name,n.Tel=o.tel,n.UID=o._id,n.Hash=o.password,n.Permission=o.permission,n.Email=o.email,n.Name=o.email,n.Favoriteap=o.favoriteap,a.permissionGlobal=n.Permission,a.username=n.Name,a.setCC=setCC("setting"),i.path("/controlpanel"),i.replace()):(console.log("2430 ctrljs"),console.log(o),alert("Please Check your username and password"))})})}}]).controller("mapCtrl",["$scope","$rootScope","Property","$window","$location","$cookies","$http","$templateCache","SponsorApartment",function(e,o,t,n,a,i,r,l,c){e.$on("$routeChangeSuccess",function(){"/homes"===a.path()&&o.$broadcast("mapReady",!0)});var s=[],d=[],p="image/icon/map_pin.png";t.query({},function(o){e.initlist=o,c.get({},function(o){for(var t=o.length-1;t>=0;t--)e.initlist.unshift(o[t])})}),e.condos=[],e.$on("mapReady",function(){try{var o={zoom:14,scrollwheel:!1,disableDoubleClickZoom:!0};e.map=new google.maps.Map(document.getElementById("map-canvas"),o),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(o){if(void 0==i.lat)var t=new google.maps.LatLng(o.coords.latitude,o.coords.longitude);else var t=new google.maps.LatLng(i.lat,i.lng);var n=new google.maps.Marker({position:t,title:"Your Location",draggable:!0,icon:p});google.maps.event.addListener(n,"dragend",function(t){for(var n=0;n<s.length;n++)s[n].setMap(null);i.lat=t.latLng.lat(),i.lng=t.latLng.lng();var a=new google.maps.LatLng(i.lat,i.lng);e.showMeTheCondo(o),e.map.setCenter(a)}),n.setMap(e.map),e.map.setCenter(t),e.showMeTheCondo(null==i.lat?o:o)},function(){e.handleNoGeolocation(!0)}):e.handleNoGeolocation(!1)}catch(t){}}),e.handleNoGeolocation=function(o){if(o)var t="Error: The Geolocation service failed. Please click on the map to change location.";else var t="Error: Your browser doesn't support geolocation. Please click on the map to change location.";{var n={map:e.map,position:new google.maps.LatLng(13.883661700000001,100.5698831),content:t};new google.maps.InfoWindow(n)}e.map.setCenter(n.position),e.showMeTheCondo(n.position)},e.showMeTheCondo=function(){rand();t.query({location:[i.lng,i.lat]},function(o){e.initlist=o;for(var t=0;t<o.length;t++){var n=new google.maps.LatLng(o[t].obj.location[1],o[t].obj.location[0]),a=new google.maps.Marker({position:n,title:o[t].obj.title});s.push(a),a.setMap(e.map);var i='<h2> <a href="#!/info?_id='+o[t].obj._id+'" target="_blank">'+o[t].obj.title+"</a></h2> <p>ค่าเช่า"+o[t].obj.price+" บาท</p><br>";e.attachInfo(a,i)}c.get({},function(o){for(var t=o.length-1;t>=0;t--)e.initlist.unshift(o[t])})})},e.attachInfo=function(e,o){var t=new google.maps.InfoWindow({content:o});d.push(t),google.maps.event.addListener(e,"click",function(){for(var o=0;o<d.length;o++)d[o].close();t.open(e.get("map"),e)})}}]).controller("Usertemp",function(e){e.actionUrl="./public/"+$cookies.UID}).controller("activeCtrl",["$scope","$routeParams","Active",function(e,o,t){t.query({email:o.email,token:o.token},function(){})}]).controller("InvoiceCtrl",["$scope","Paysbuy","CreateTransaction",function(e,o,t){e.payment={},e.invoicestat=!1,e.send_payment=function(){console.log(e.amount),t.post({amt:e.amount},function(o){o.invoice&&(console.log(o.invoice),e.invoicenumber=o.invoice,e.invoicestat=!0)})}}]).controller("controlpanelCtrl",function(){}).controller("firstStepCtrl",function(e){e.isNotSearch=!0}).controller("listcontroller",function(e,o,t,n){e.items1=[],e.items2=[],e.items3=[],e.password="",e.del_tel=function(o){var t=e.items1.indexOf(o);t>-1&&e.items1.splice(t,1)},e.del_mobile=function(o){var t=e.items2.indexOf(o);t>-1&&e.items2.splice(t,1)},e.del_fax=function(o){var t=e.items3.indexOf(o);t>-1&&e.items3.splice(t,1)},e.actionUrl="/logosave?_id="+n.UID,e.fine=function(e){var o="fine_date="+e.date_no+"&fine_cost="+e.fine_cost+"&_id="+n.building_id;t.post("/fineupdate?"+o).success(function(e,o){alert(200==o?"building updated"+n.building_id:"please check your information")})},e.docupdate=function(e){var o=document.getElementsByTagName("input")[9].files[0].name,a="company_address="+e.comp_address+"&amphures="+e.comp_aumphures+"&district="+e.comp_district+"&province="+e.comp_province+"&postcode="+e.comp_postcode+"&tel_doc="+e.comp_tel+"&mobile_doc="+e.comp_mobile+"&fax_doc="+e.comp_fax+"&web_site="+e.comp_site+"&company_name="+e.comp_name+"&_id="+n.building_id+"&logo="+o;t.post("/docupdate?"+a).success(function(e,o){alert(200==o?"building updated"+n.building_id:"please check your information")})},e.create=function(e){var o="userid="+n.UID+"&building="+e.building_name+"&address="+e.building_address+"&tel="+e.building_tel+"&fax="+e.building_fax+"&detail="+e.building_detail;t.post("/createbuilding?"+o).success(function(e,o){200==o?(n.building_id=e._id,alert("building created"+n.building_id)):alert("please check your information")})},this.room=[{roomno:"1",stat:"yes"},{roomno:"2",stat:"no"},{roomno:"3",stat:"yes"},{roomno:"4",stat:"no"},{roomno:"5",stat:"yes"},{roomno:"6",stat:"yes"},{roomno:"7",stat:"no"},{roomno:"8",stat:"no"},{roomno:"9",stat:"yes"},{roomno:"10",stat:"yes"},{roomno:"11",stat:"no"},{roomno:"12",stat:"no"}],this.myDropDown="zero",e.date_val2=new Date,e.date_val1=new Date,e.total_sum=function(e,o,t,n,a){return void 0===e&&(e=0),void 0===o&&(o=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===a&&(a=0),parseInt(e)+parseInt(o)+parseInt(t)+parseInt(n)+parseInt(a)},e.adds1=function(o){e.items1.contains(o)||""==o||e.items1.push(o),this.tel=""},e.adds2=function(o){e.items2.contains(o)||""==o||e.items2.push(o),this.mobile=""},e.adds3=function(o){e.items3.contains(o)||""==o||e.items3.push(o),this.fax=""}});
